<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FANZZ777 - Bandar</title>
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/header.css">
<link rel="stylesheet" href="css/menu.css">
<link rel="stylesheet" href="css/animation.css">
<style>
body {background:#0d0d0d; color:gold; font-family:sans-serif;}
.header {display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#111;}
.header .logo {font-size:24px; font-weight:bold; color:gold;}
.menu {display:flex; justify-content:space-around; background:#121212; padding:10px 0; flex-wrap:wrap;}
.menu button {background:transparent; border:none; color:gold; font-weight:bold; cursor:pointer; display:flex; align-items:center; gap:5px; transition:transform 0.2s;}
.menu button:hover {transform:scale(1.05);}
.menu button img {width:32px; height:32px;}
table {width:100%; border-collapse:collapse; margin-top:10px;}
table th, table td {border:1px solid gold; padding:8px; text-align:center;}
table th {background:#222;}
.actions button {padding:6px 10px; border-radius:6px; border:none; background:#222; color:gold; cursor:pointer; margin:2px;}
.modal {display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#222; padding:20px; border-radius:12px; color:gold; z-index:1000; width:90%; max-width:400px;}
input, select {width:100%; padding:6px; margin:5px 0; border-radius:6px; border:none; outline:none; background:#333; color:gold;}
button:hover {transform:scale(1.05);}
</style>
</head>
<body>

<header class="header">
  <div class="logo">FANZZ777 - Bandar</div>
  <div id="authBox"></div>
</header>

<main id="panel" class="content">
  <h2>Panel Bandar</h2>
  <div id="bandarActions" class="actions" style="display:none;">
    <button onclick="showPlayers()">Daftar Pemain</button>
    <button onclick="showHistory()">Histori</button>
    <button onclick="showLeaderboard()">Leaderboard</button>
    <button onclick="logoutBandar()">Logout</button>
  </div>

  <!-- Daftar Pemain -->
  <div id="playerListPanel" class="panel">
    <h3>Daftar Pemain</h3>
    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>E-Wallet</th>
          <th>Bank</th>
          <th>Saldo</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="playerTableBody"></tbody>
    </table>
  </div>

  <!-- Histori -->
  <div id="historyPanel" class="panel">
    <h3>Histori Transaksi Semua Pemain</h3>
    <table>
      <thead>
        <tr><th>User</th><th>Jenis</th><th>Jumlah</th><th>Tanggal</th></tr>
      </thead>
      <tbody id="historyTableBody"></tbody>
    </table>
  </div>

  <!-- Leaderboard -->
  <div id="leaderboardPanel" class="panel">
    <h3>Leaderboard</h3>
    <table>
      <thead><tr><th>User</th><th>Total Transaksi</th></tr></thead>
      <tbody id="leaderboardTableBody"></tbody>
    </table>
  </div>
</main>

<!-- Login Bandar -->
<div id="loginModal" class="modal">
  <h3>Login Bandar</h3>
  <input type="text" id="bandarUsername" placeholder="Username">
  <input type="password" id="bandarPassword" placeholder="Password">
  <br>
  <button onclick="loginBandar()">Login</button>
</div>

<!-- Deposit/Withdraw Modal -->
<div id="transModal" class="modal">
  <h3 id="transTitle"></h3>
  <p>Username: <span id="transUser"></span></p>
  <input type="number" id="transAmount" placeholder="Masukkan jumlah">
  <select id="transType">
    <option value="deposit">Deposit</option>
    <option value="withdraw">Withdraw</option>
  </select>
  <br><br>
  <button onclick="confirmTrans()">Konfirmasi</button>
  <button onclick="closeTrans()">Batal</button>
</div>

<script>
// ----- AUTH BANDAR -----
const bandarAcc = {username:"bandar", password:"bandar123"};
function renderAuthBox(){
  const authBox = document.getElementById('authBox');
  if(localStorage.getItem('bandarLogged')==='true'){
    authBox.innerHTML=`<span>Hi, Bandar</span>`;
    document.getElementById('bandarActions').style.display='block';
    showPlayers();
  } else {
    authBox.innerHTML='';
    document.getElementById('bandarActions').style.display='none';
    openBandarLogin();
  }
}

function openBandarLogin(){ document.getElementById('loginModal').style.display='block'; }
function loginBandar(){
  const user = document.getElementById('bandarUsername').value.trim();
  const pass = document.getElementById('bandarPassword').value;
  if(user===bandarAcc.username && pass===bandarAcc.password){
    localStorage.setItem('bandarLogged','true');
    alert("Login Bandar Berhasil!");
    document.getElementById('loginModal').style.display='none';
    renderAuthBox();
  } else { alert("Username/Password salah!"); }
}
function logoutBandar(){
  localStorage.removeItem('bandarLogged');
  renderAuthBox();
  alert("Logout Bandar berhasil!");
}

// ----- DAFTAR PEMAIN -----
function showPlayers(){
  hidePanels();
  document.getElementById('playerListPanel').style.display='block';
  const players = JSON.parse(localStorage.getItem('players')) || [];
  const tbody = document.getElementById('playerTableBody');
  tbody.innerHTML='';
  players.forEach((p,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${p.username}</td>
      <td>${p.email}</td>
      <td>${p.ewallet || '-'}</td>
      <td>${p.bank || '-'}</td>
      <td>${p.saldo}</td>
      <td>
        <button onclick="openTrans('${p.username}','deposit')">Deposit</button>
        <button onclick="openTrans('${p.username}','withdraw')">Withdraw</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

// ----- TRANSAKSI -----
function openTrans(user,type){
  document.getElementById('transModal').style.display='block';
  document.getElementById('transUser').innerText=user;
  document.getElementById('transType').value=type;
  document.getElementById('transAmount').value='';
  document.getElementById('transTitle').innerText=`${type.toUpperCase()} untuk ${user}`;
}
function closeTrans(){ document.getElementById('transModal').style.display='none'; }
function confirmTrans(){
  const user = document.getElementById('transUser').innerText;
  const type = document.getElementById('transType').value;
  const amount = parseInt(document.getElementById('transAmount').value);
  if(!amount){ alert("Masukkan jumlah!"); return; }

  let players = JSON.parse(localStorage.getItem('players')) || [];
  const player = players.find(p=>p.username===user);
  if(!player){ alert("Player tidak ditemukan!"); return; }

  if(type==='deposit'){ player.saldo += amount; }
  else {
    if(player.saldo<amount){ alert("Saldo tidak cukup!"); return; }
    player.saldo -= amount;
  }
  localStorage.setItem('players',JSON.stringify(players));

  let history = JSON.parse(localStorage.getItem('history')) || [];
  history.push({user, type, amount, date:new Date().toLocaleString()});
  localStorage.setItem('history',JSON.stringify(history));
  alert(type.charAt(0).toUpperCase()+type.slice(1)+' berhasil!');
  closeTrans();
  showPlayers();
}

// ----- HISTORI -----
function showHistory(){
  hidePanels();
  document.getElementById('historyPanel').style.display='block';
  const history = JSON.parse(localStorage.getItem('history')) || [];
  const tbody = document.getElementById('historyTableBody');
  tbody.innerHTML='';
  history.forEach(h=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${h.user}</td><td>${h.type}</td><td>${h.amount}</td><td>${h.date}</td>`;
    tbody.appendChild(tr);
  });
}

// ----- LEADERBOARD -----
function showLeaderboard(){
  hidePanels();
  document.getElementById('leaderboardPanel').style.display='block';
  const history = JSON.parse(localStorage.getItem('history')) || [];
  const leaderboard = {};
  history.forEach(h=>{ if(!leaderboard[h.user]) leaderboard[h.user]=0; leaderboard[h.user]+=h.amount; });
  const sorted = Object.entries(leaderboard).sort((a,b)=>b[1]-a[1]);
  const tbody = document.getElementById('leaderboardTableBody'); tbody.innerHTML='';
  sorted.forEach(([user,total])=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${user}</td><td>${total}</td>`;
    tbody.appendChild(tr);
  });
}

function hidePanels(){
  document.getElementById('playerListPanel').style.display='none';
  document.getElementById('historyPanel').style.display='none';
  document.getElementById('leaderboardPanel').style.display='none';
}

// ----- LOAD -----
renderAuthBox();
</script>
</body>
</html>
