<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FANZZ777 - Bandar</title>
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/header.css">
<link rel="stylesheet" href="css/menu.css">
<link rel="stylesheet" href="css/animation.css">
<style>
body { background:#111; color:gold; font-family:Arial, sans-serif; }
.header { background:#222; padding:10px; text-align:center; font-size:24px; font-weight:bold; color:gold; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid gold; padding:8px; text-align:center; }
th { background:#333; }
button { padding:5px 10px; border:none; border-radius:6px; background:gold; color:#111; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>
<header class="header">Panel Bandar FANZZ777</header>

<h3>Pending Deposit / Withdraw</h3>
<table id="pendingTable">
  <thead>
    <tr>
      <th>Username</th>
      <th>Type</th>
      <th>Nominal</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ----- BANDAR CONTROL -----
function loadPending(){
  const history = JSON.parse(localStorage.getItem('history')) || [];
  const pending = history.filter(h=>!h.approved);
  const tbody = document.querySelector('#pendingTable tbody');
  tbody.innerHTML='';
  pending.forEach((h,index)=>{
    const tr=document.createElement('tr');
    const nom = h.amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");
    tr.innerHTML=`<td>${h.user}</td><td>${h.type}</td><td>${nom}</td>
                   <td><button onclick="approve(${index})">ACC</button></td>`;
    tbody.appendChild(tr);
  });
}

function approve(idx){
  const history = JSON.parse(localStorage.getItem('history')) || [];
  const entry = history.filter(h=>!h.approved)[idx];
  if(!entry) return;

  if(entry.type==='Withdraw'){
    // kurangi saldo pemain
    let players = JSON.parse(localStorage.getItem('players'))||[];
    let player = players.find(p=>p.username===entry.user);
    if(player && player.saldo>=entry.amount){
      player.saldo -= entry.amount;
      localStorage.setItem('players', JSON.stringify(players));
    } else { alert("Saldo tidak cukup!"); return; }
  }
  entry.approved = true;
  localStorage.setItem('history', JSON.stringify(history));
  loadPending();
}

window.onload = loadPending;
</script>
</body>
</html>
