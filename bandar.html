<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FANZZ777 - Bandar Panel</title>
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/header.css">
<link rel="stylesheet" href="css/menu.css">
<link rel="stylesheet" href="css/animation.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#111;color:gold;font-family:sans-serif}
.header{display:flex;justify-content:space-between;padding:10px;background:#000;border-bottom:2px solid gold}
.header .logo{font-weight:bold;font-size:1.5em;color:gold}
.menu{display:flex;gap:5px;flex-wrap:wrap;margin:5px 0}
.menu button{flex:1;padding:8px;background:#222;color:gold;border:none;border-radius:6px;cursor:pointer}
.menu button:hover{background:gold;color:#111}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid gold;padding:5px;text-align:center}
th{background:#222}
.modal{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#111;color:gold;padding:20px;border-radius:12px;z-index:1000;max-width:600px;width:90%;box-shadow:0 0 20px gold}
button{cursor:pointer;font-weight:bold;border:none;border-radius:6px;padding:6px 12px;margin:3px;background:gold;color:#111}
#authModal input,#authModal select{margin:5px 0;padding:5px;width:100%;border-radius:6px;background:#000;color:gold;border:1px solid gold}
#authModal button{margin-top:10px;width:100%}
#chartContainer{width:100%;max-width:600px;margin-top:20px}
</style>
</head>
<body>

<header class="header">
  <div class="logo">FANZZ777 - Bandar Panel</div>
</header>

<main>
<h2>Daftar Transaksi Pemain</h2>
<table>
<thead>
<tr>
<th>Username</th>
<th>Jenis Rekening</th>
<th>Nama Rekening</th>
<th>Nomor Rekening / Wallet</th>
<th>Deposit</th>
<th>Withdraw</th>
<th>Status</th>
</tr>
</thead>
<tbody id="playerTable"></tbody>
</table>

<div id="chartContainer">
<canvas id="chart"></canvas>
</div>
</main>

<!-- LOGIN MODAL BANDAR -->
<div id="authModal" class="modal">
<h3>Login Bandar</h3>
<input id="bandarUsername" placeholder="Username">
<input id="bandarPassword" type="password" placeholder="Password">
<button onclick="loginBandar()">Login</button>
</div>

<script>
// === BANDAR LOGIN ===
let bandars = [
  {username:"bandar1",password:"fanzz777"},
  {username:"bandar2",password:"fanzz888"}
];
let currentBandar = null;

function loginBandar(){
  const u = document.getElementById('bandarUsername').value;
  const p = document.getElementById('bandarPassword').value;
  const b = bandars.find(x=>x.username===u && x.password===p);
  if(!b){alert("Username atau password salah");return;}
  currentBandar = b;
  document.getElementById('authModal').style.display='none';
  loadPlayers();
}

// === GET PLAYERS ===
function getPlayers(){return JSON.parse(localStorage.players||"[]")}

// === LOAD TABEL PEMAIN ===
function loadPlayers(){
  const tbody = document.getElementById('playerTable');
  const players = getPlayers();
  tbody.innerHTML = "";
  let chartLabels=[], chartDeposit=[], chartWithdraw=[];
  players.forEach(p=>{
    p.history.forEach((h,i)=>{
      let type = h.split(" ")[0];
      let amt = h.split(" ")[1];
      let status = h.includes("ACC")?"acc":"pending";
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.username}</td>
        <td>${p.wallet||p.bank}</td>
        <td>${p.name}</td>
        <td>${p.walletNum||p.bankNum}</td>
        <td>${type==="Deposit"?amt:0}</td>
        <td>${type==="Withdraw"?amt:0}</td>
        <td>${status === "pending" ? `<button onclick="act('${p.username}',${amt},'${type}',${i},'acc')">ACC</button>`: "âœ“ ACC"}</td>
      `;
      tbody.appendChild(tr);
      if(status==="acc"){
        chartLabels.push(p.username);
        chartDeposit.push(type==="Deposit"?Number(amt):0);
        chartWithdraw.push(type==="Withdraw"?Number(amt):0);
      }
    })
  })
  updateChart(chartLabels,chartDeposit,chartWithdraw);
}

// === ACC TRANSAKSI ===
function act(u,a,t,idx,st){
  let P = getPlayers();
  P = P.map(x=>{
    if(x.username === u){
      x.history = x.history.map((h,i)=>{
        if(i===idx && h.includes("Menunggu")){
          if(st==="acc"){
            if(t==="Deposit") x.saldo += Number(a);
            if(t==="Withdraw") x.saldo -= Number(a);
          }
          h = h.replace("Menunggu ACC","ACC");
        }
        return h;
      });
    }
    return x;
  });
  localStorage.players = JSON.stringify(P);
  localStorage.playersBackup = localStorage.players;
  loadPlayers();
}

// === CHART GRAFIK ===
let chartObj;
function updateChart(labels,dDeposit,dWithdraw){
  const ctx = document.getElementById('chart').getContext('2d');
  if(chartObj) chartObj.destroy();
  chartObj = new Chart(ctx,{
    type:'bar',
    data:{
      labels:labels,
      datasets:[
        {label:'Deposit',data:dDeposit,backgroundColor:'gold'},
        {label:'Withdraw',data:dWithdraw,backgroundColor:'red'}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:'gold'}}},
      scales:{x:{ticks:{color:'gold'}},y:{ticks:{color:'gold'}}}
    }
  });
}

// === AUTO SHOW LOGIN ===
window.onload = ()=>{ document.getElementById('authModal').style.display='block' }
</script>
</body>
</html>
