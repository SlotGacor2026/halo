<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Bandar - FANZZ777</title>

<style>
body{
  background:#000;
  color:gold;
  font-family:Arial,Helvetica,sans-serif;
}
h1{
  text-align:center;
  margin-top:20px;
}
button{
  background:gold;
  color:#000;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
button:hover{opacity:.8}

.table-wrap{
  width:100%;
  overflow-x:auto;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}
th,td{
  border:1px solid #333;
  padding:10px;
  text-align:center;
}
th{
  background:#111;
}
.empty{
  text-align:center;
  margin-top:40px;
  opacity:.7;
}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:10px 0;
}
.refresh{
  background:#ffd700;
}
</style>
</head>

<body>

<h1>ðŸ“Š PANEL BANDAR</h1>

<div class="topbar">
  <div></div>
  <button class="refresh" onclick="loadRequests()">ðŸ”„ Refresh</button>
</div>

<div class="table-wrap">
<table>
<thead>
<tr>
  <th>Username</th>
  <th>Jenis</th>
  <th>Nama Rekening</th>
  <th>Nomor Rekening</th>
  <th>Nominal</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="reqTable"></tbody>
</table>
</div>

<div id="emptyText" class="empty">
  Tidak ada permintaan Deposit / Withdraw
</div>

<script>
function loadRequests(){
  const players = JSON.parse(localStorage.players || "[]");
  const tbody = document.getElementById("reqTable");
  const empty = document.getElementById("emptyText");

  tbody.innerHTML = "";
  let found = false;

  players.forEach(player=>{
    player.history.forEach(h=>{
      if(typeof h === "object" && h.status === "pending"){
        found = true;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${player.username}</td>
          <td>${h.type.toUpperCase()}</td>
          <td>${player.name}</td>
          <td>${player.wallet ? player.wallet+" - "+player.walletNum : player.bank+" - "+player.bankNum}</td>
          <td>${h.amount}</td>
          <td>
            <button onclick="acc('${player.username}','${h.type}',${h.amount},${h.time})">
              ACC
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      }
    });
  });

  empty.style.display = found ? "none" : "block";
}

function acc(username,type,amount,time){
  let players = JSON.parse(localStorage.players || "[]");

  players = players.map(p=>{
    if(p.username === username){
      // update saldo
      if(type === "deposit") p.saldo += amount;
      if(type === "withdraw") p.saldo -= amount;

      // update history
      p.history = p.history.map(h=>{
        if(
          typeof h === "object" &&
          h.status === "pending" &&
          h.amount === amount &&
          h.type === type &&
          h.time === time
        ){
          h.status = "acc";
        }
        return h;
      });
    }
    return p;
  });

  localStorage.players = JSON.stringify(players);

  // update current player if same user open
  let current = JSON.parse(localStorage.current || "null");
  if(current && current.username === username){
    const updated = players.find(p=>p.username===username);
    localStorage.current = JSON.stringify(updated);
  }

  alert("ACC berhasil âœ… Saldo pemain terupdate");
  loadRequests();
}

loadRequests();
</script>

</body>
</html>
