<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONTROL BANDAR</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:black;
    color:white;
}

.container{
    width:95%;
    max-width:1100px;
    margin:auto;
    margin-top:40px;
    background:#111;
    padding:20px;
    border-radius:10px;
}

h2{
    text-align:center;
    color:gold;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}

th,td{
    border:1px solid #333;
    padding:8px;
    text-align:center;
}

th{
    background:#222;
    color:gold;
}

button{
    padding:5px 10px;
    border:none;
    cursor:pointer;
    border-radius:4px;
}

.approve{background:green;color:white;}
.reject{background:red;color:white;}

.control-box{
    margin-top:30px;
    background:#222;
    padding:15px;
    border-radius:8px;
}

input{
    padding:5px;
    margin:5px;
}
.logout{
    margin-top:20px;
    background:red;
    color:white;
    width:100%;
    padding:10px;
}
</style>
</head>
<body>

<div class="container">

<h2>CONTROL BANDAR</h2>

<table>
<thead>
<tr>
<th>Username</th>
<th>Jenis Rekening</th>
<th>Nama Rekening</th>
<th>Nomor Rekening</th>
<th>Deposit / Withdraw</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="transactionTable">
</tbody>
</table>

<div class="control-box">
<h3>Kontrol Permainan</h3>

RTP % <input type="number" id="rtp" value="80">
Win Rate % <input type="number" id="winrate" value="40">
Max Multiplier <input type="number" id="maxwin" value="5">
<label><input type="checkbox" id="freespin" checked> Free Spin Aktif</label>
<br>
<button onclick="saveSettings()">Simpan Pengaturan</button>

<h3>Tambah / Kurangi Saldo Player</h3>
Username <input type="text" id="userTarget">
Jumlah <input type="number" id="saldoEdit">
<button onclick="editSaldo()">Update</button>

</div>

<button class="logout" onclick="logout()">Logout</button>

</div>

<script>
/* ===== LOAD TRANSAKSI ===== */
let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
let settings = JSON.parse(localStorage.getItem("gameSettings")) || {
    rtp:80,
    winrate:40,
    maxwin:5,
    freespin:true
};

document.getElementById("rtp").value=settings.rtp;
document.getElementById("winrate").value=settings.winrate;
document.getElementById("maxwin").value=settings.maxwin;
document.getElementById("freespin").checked=settings.freespin;

function renderTable(){
    let pemainData = JSON.parse(localStorage.getItem("pemainData")) || [];
    const table = document.getElementById("transactionTable");
    table.innerHTML="";

    pemainData
    .filter(t=>t.status==="pending")
    .forEach((t,index)=>{
        table.innerHTML+=`
        <tr>
        <td>${t.username}</td>
        <td>${t.jenis} - ${t.provider}</td>
        <td>${t.nama}</td>
        <td>${t.rekening}</td>
        <td>${t.tipe} - Rp ${t.jumlah}</td>
        <td>${t.status}</td>
        <td>
        <button onclick="approve(${index})">Approve</button>
        <button onclick="reject(${index})">Reject</button>
        </td>
        </tr>
        `;
    });
}

function approve(i){
    let pemainData = JSON.parse(localStorage.getItem("pemainData")) || [];
    let players = JSON.parse(localStorage.getItem("players")) || [];
    let current = JSON.parse(localStorage.getItem("current")) || null;

    let trx = pemainData[i];
    if(!trx) return;

    let playerIndex = players.findIndex(p=>p.username === trx.username);
    if(playerIndex === -1){
        alert("Player tidak ditemukan");
        return;
    }

    if(trx.tipe === "DEPOSIT"){
        players[playerIndex].saldo += parseInt(trx.jumlah);
    }

    if(trx.tipe === "WITHDRAW"){
        if(players[playerIndex].saldo < trx.jumlah){
            alert("Saldo tidak cukup!");
            return;
        }
        players[playerIndex].saldo -= parseInt(trx.jumlah);
    }

    // UPDATE current jika player sedang login
    if(current && current.username === trx.username){
        current.saldo = players[playerIndex].saldo;
        localStorage.setItem("current", JSON.stringify(current));
    }

    // HAPUS transaksi setelah approve
    pemainData.splice(i,1);

    localStorage.setItem("players", JSON.stringify(players));
    localStorage.setItem("pemainData", JSON.stringify(pemainData));

    alert("Approve berhasil!");
    renderTable();
}

function reject(i){
    let pemainData = JSON.parse(localStorage.getItem("pemainData")) || [];

    pemainData.splice(i,1); // langsung hapus

    localStorage.setItem("pemainData", JSON.stringify(pemainData));

    alert("Reject berhasil!");
    renderTable();
}

renderTable();

function reject(i){
    let pemainData = JSON.parse(localStorage.getItem("pemainData")) || [];

    if(pemainData[i].status !== "pending"){
        alert("Sudah diproses!");
        return;
    }

    pemainData[i].status = "rejected";

    localStorage.setItem("pemainData", JSON.stringify(pemainData));

    alert("Transaksi di reject!");
    renderTable();
}

renderTable();

/* ===== APPROVE ===== */
function approve(i){
    pemainData[i].status="approved";

    let saldo = parseInt(localStorage.getItem("playerBalance")) || 0;

    if(pemainData[i].tipe==="DEPOSIT"){
        saldo += parseInt(pemainData[i].jumlah);
    }

    if(pemainData[i].tipe==="WITHDRAW"){
        saldo -= parseInt(pemainData[i].jumlah);
    }

    localStorage.setItem("playerBalance", saldo);
    localStorage.setItem("pemainData", JSON.stringify(pemainData));
    renderTable();
}

/* ===== REJECT ===== */
function reject(i){
    pemainData[i].status="rejected";
    localStorage.setItem("pemainData", JSON.stringify(pemainData));
    renderTable();
}
/* ===== SAVE SETTINGS ===== */
function saveSettings(){
    settings = {
        rtp: document.getElementById("rtp").value,
        winrate: document.getElementById("winrate").value,
        maxwin: document.getElementById("maxwin").value,
        freespin: document.getElementById("freespin").checked
    };
    localStorage.setItem("gameSettings", JSON.stringify(settings));
    alert("Pengaturan disimpan!");
}

/* ===== EDIT SALDO ===== */
function editSaldo(){
    let user=document.getElementById("userTarget").value;
    let amount=parseInt(document.getElementById("saldoEdit").value);

    if(user==="player"){
        let bal=parseInt(localStorage.getItem("playerBalance"))||0;
        bal+=amount;
        localStorage.setItem("playerBalance",bal);
        alert("Saldo diperbarui!");
    }
}

function logout(){
    window.location.href="index.html";
}
</script>

</body>
</html>
