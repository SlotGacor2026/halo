<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONTROL BANDAR</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:black;
    color:white;
}

.container{
    width:95%;
    max-width:1100px;
    margin:auto;
    margin-top:40px;
    background:#111;
    padding:20px;
    border-radius:10px;
}

h2{
    text-align:center;
    color:gold;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}

th,td{
    border:1px solid #333;
    padding:8px;
    text-align:center;
}

th{
    background:#222;
    color:gold;
}

button{
    padding:5px 10px;
    border:none;
    cursor:pointer;
    border-radius:4px;
}

.approve{background:green;color:white;}
.reject{background:red;color:white;}

.control-box{
    margin-top:30px;
    background:#222;
    padding:15px;
    border-radius:8px;
}

input{
    padding:5px;
    margin:5px;
}
.logout{
    margin-top:20px;
    background:red;
    color:white;
    width:100%;
    padding:10px;
}
</style>
</head>
<body>

<div class="container">

<h2>CONTROL BANDAR</h2>

<table>
<thead>
<tr>
<th>Username</th>
<th>Jenis Rekening</th>
<th>Nama Rekening</th>
<th>Nomor Rekening</th>
<th>Deposit / Withdraw</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="transactionTable">
</tbody>
</table>

<div class="control-box">
<h3>Kontrol Permainan</h3>

RTP % <input type="number" id="rtp" value="80">
Win Rate % <input type="number" id="winrate" value="40">
Max Multiplier <input type="number" id="maxwin" value="5">
<label><input type="checkbox" id="freespin" checked> Free Spin Aktif</label>
<br>
<button onclick="saveSettings()">Simpan Pengaturan</button>

<h3>Tambah / Kurangi Saldo Player</h3>
Username <input type="text" id="userTarget">
Jumlah <input type="number" id="saldoEdit">
<button onclick="editSaldo()">Update</button>

</div>

<button class="logout" onclick="logout()">Logout</button>

</div>

<script>
function renderTable(){
    let pemainData = JSON.parse(localStorage.getItem("pemainData")) || [];
    const table = document.getElementById("transactionTable");
    table.innerHTML="";

    pemainData.forEach((t,index)=>{
        table.innerHTML+=`
        <tr>
        <td>${t.username}</td>
        <td>${t.jenis} - ${t.provider}</td>
        <td>${t.nama}</td>
        <td>${t.rekening}</td>
        <td>${t.tipe} - Rp ${t.jumlah}</td>
        <td>${t.status}</td>
        <td>
        <button class="approve" onclick="approve(${index})">Approve</button>
        <button class="reject" onclick="reject(${index})">Reject</button>
        </td>
        </tr>
        `;
    });
}

function approve(i){
    let pemainData = JSON.parse(localStorage.getItem("pemainData")) || [];
    let players = JSON.parse(localStorage.getItem("players")) || [];
    let current = JSON.parse(localStorage.getItem("current")) || null;

    let trx = pemainData[i];
    if(!trx) return;

    let playerIndex = players.findIndex(p=>p.username === trx.username);
    if(playerIndex === -1){
        alert("Player tidak ditemukan");
        return;
    }

    if(trx.tipe === "DEPOSIT"){
        players[playerIndex].saldo += parseInt(trx.jumlah);
    }

    if(trx.tipe === "WITHDRAW"){
        if(players[playerIndex].saldo < trx.jumlah){
            alert("Saldo tidak cukup!");
            return;
        }
        players[playerIndex].saldo -= parseInt(trx.jumlah);
    }

    // update current kalau user lagi login
    if(current && current.username === trx.username){
        current.saldo = players[playerIndex].saldo;
        localStorage.setItem("current", JSON.stringify(current));
    }

    // update history jadi APPROVED
    players[playerIndex].history.forEach(h=>{
        if(h.amount == trx.jumlah && h.status === "PENDING"){
            h.status = "APPROVED";
        }
    });

    // hapus transaksi dari tabel
    pemainData.splice(i,1);

    localStorage.setItem("players", JSON.stringify(players));
    localStorage.setItem("pemainData", JSON.stringify(pemainData));

    alert("Transaksi di approve!");
    renderTable();
}

function reject(i){
    let pemainData = JSON.parse(localStorage.getItem("pemainData")) || [];
    let players = JSON.parse(localStorage.getItem("players")) || [];

    let trx = pemainData[i];
    if(!trx) return;

    let playerIndex = players.findIndex(p=>p.username === trx.username);

    if(playerIndex !== -1){
        players[playerIndex].history.forEach(h=>{
            if(h.amount == trx.jumlah && h.status === "PENDING"){
                h.status = "REJECTED";
            }
        });
    }

    pemainData.splice(i,1);

    localStorage.setItem("players", JSON.stringify(players));
    localStorage.setItem("pemainData", JSON.stringify(pemainData));

    alert("Transaksi di reject!");
    renderTable();
}

function saveSettings(){
    let settings = {
        rtp: document.getElementById("rtp").value,
        winrate: document.getElementById("winrate").value,
        maxwin: document.getElementById("maxwin").value,
        freespin: document.getElementById("freespin").checked
    };
    localStorage.setItem("gameSettings", JSON.stringify(settings));
    alert("Pengaturan disimpan!");
}

function editSaldo(){
    let user=document.getElementById("userTarget").value;
    let amount=parseInt(document.getElementById("saldoEdit").value);

    let players = JSON.parse(localStorage.getItem("players")) || [];
    let current = JSON.parse(localStorage.getItem("current")) || null;

    let playerIndex = players.findIndex(p=>p.username === user);
    if(playerIndex === -1){
        alert("User tidak ditemukan");
        return;
    }

    players[playerIndex].saldo += amount;

    if(current && current.username === user){
        current.saldo = players[playerIndex].saldo;
        localStorage.setItem("current", JSON.stringify(current));
    }

    localStorage.setItem("players", JSON.stringify(players));
    alert("Saldo diperbarui!");
}

function logout(){
    window.location.href="index.html";
}

renderTable();
</script>

</body>
</html>
